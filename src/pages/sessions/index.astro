---
import { getCollection, getEntry } from "astro:content";

import Footer from "../../components/Common/Footer.astro";
import Navbar from "../../components/Common/Navbar.astro";
import PageHead from "../../components/Common/PageHead.astro";
import PageTitle from "../../components/Common/PageTitle.astro";

// is your "component frontmatter". It never runs in the browser.
console.log("This runs in your terminal, not the browser!");

const sessions = await getCollection("sessions");

console.log(sessions.map((s) => s.data.speaker.slug));

const speakersEntries = await Promise.all(
  sessions.map((s) => getEntry(s.data.speaker))
);

const speakerDict = {};
speakersEntries.forEach((s) => (speakerDict[s!.slug] = s!.data));
---

<!-- Below is your "component template." It's just HTML, but with
     some magic sprinkled in to help you build great templates. -->
<html lang="it" class="scroll-smooth">
  <PageHead />

  <body class="flex flex-col">
    <Navbar />

    <main
      id="swup"
      class="main-content transition-fade flex flex-col max-w-6xl m-auto px-4 flex-1"
      data-swup="0"
    >
      <PageTitle title="Sessions" />

      <div
        class="grid lg:grid-cols-3 md:grid-cols-2 grid-flow-row gap-4 mt-5 mb-7"
      >
        {
          sessions.map((s) => (
            <a href={`/sessions/${s.slug}`} class="p-3 hover:shadow-lg shadow-md duration-150 ease-in flex flex-col">
              <p class="text-xl font-semibold mb-3">{s.data.title}</p>
              <div class="flex flex-wrap gap-2">
                <div class="py-1 px-2  rounded-md bg-green-600 text-white">
                  <span class="text-sm">{s.data.level}</span>
                </div>

                {
                  s.data.tags.map((t) => (
                    <div class="py-1 px-2 rounded-md bg-gray-200 text-gray-800">
                      <span class="text-sm">{t}</span>
                    </div>
                  ))
                }
              </div>
              <div class="my-3 mx-4 border border-t-0 border-gray-400/50" />
              <div class="flex flex-row">
                <div class="flex-none w-10 pr-3">
                  <img
                    class="rounded-full "
                    src={`/assets/images/speakers/${
                      speakerDict[s.data.speaker.slug].image
                    }`}
                    alt={speakerDict[s.data.speaker.slug].name}
                  />
                </div>
                <div class="flex-1">
                  <p class="text-md">{speakerDict[s.data.speaker.slug].name}</p>
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </main>
    <Footer />
  </body>
</html>
